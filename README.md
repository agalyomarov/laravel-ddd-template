# CRM API — Создание и обработка заявок (DDD-подход)

## Описание

Это пример архитектуры API для CRM-системы, реализованной по принципам **Domain-Driven Design (DDD)** и чистой архитектуры.

В CRM заявки (`Lead`) создаются через API, а затем обрабатываются операторами, менеджерами и кредитным отделом. Вся бизнес-логика вынесена в доменный слой, контроллеры отвечают только за приём и отдачу данных.

---

## Архитектурные принципы

-   **Разделение слоёв:**

    -   **Presentation** — API контроллеры, прием и отдача HTTP-запросов
    -   **Application** — сервисы и команды, реализующие бизнес-процессы
    -   **Domain** — сущности, value objects, доменные события, бизнес-правила
    -   **Infrastructure** — конкретные реализации репозиториев, интеграции, хранилища

-   **Изоляция домена:**

    -   Доменный слой не зависит от фреймворков и инфраструктуры
    -   Бизнес-правила и валидация в доменных объектах и сервисах
    -   Контроллеры и API — тонкие адаптеры

-   **Роли и права:**
    -   Управление доступом реализуется на уровне Application/Domain (политики, guards)
    -   Операторы, менеджеры и кредитный отдел имеют разные возможности работы с заявками

---

## Структура проекта (пример)

```

app/
├── Domain/
│ └── Lead/
│ ├── Entities/
│ │ └── Lead.php
│ ├── ValueObjects/
│ │ └── LeadStatus.php
│ ├── Events/
│ │ └── LeadWasCreated.php
│ ├── Repositories/
│ │ └── LeadRepositoryInterface.php
│ └── Policies/
│ └── LeadAccessPolicy.php
├── Application/
│ └── Lead/
│ ├── Commands/
│ │ └── CreateLeadCommand.php
│ ├── Handlers/
│ │ └── CreateLeadHandler.php
│ └── Services/
│ └── LeadApplicationService.php
├── Infrastructure/
│ └── Persistence/
│ └── SqlLeadRepository.php
└── Presentation/
└── Http/
└── Controllers/
└── LeadApiController.php

```

---

## Пример рабочего процесса создания заявки

1. **Клиент** отправляет POST-запрос на `/api/v1/leads`
2. **LeadApiController** принимает и валидирует данные (через Form Request или вручную)
3. Контроллер формирует **CreateLeadCommand** и передаёт в **CreateLeadHandler** (Application Layer)
4. Handler создаёт новый объект **Lead** (Domain Entity) и сохраняет через **LeadRepositoryInterface**
5. Генерируется событие **LeadWasCreated**, которое может обработать подписчик (например, уведомление менеджера)
6. Ответ с ID созданной заявки возвращается клиенту

---

## Роли и права

-   Проверки и ограничения на действия (создание, назначение, изменение статуса) реализуются через **Policies** в доменном слое или Application Service
-   Роли:
    -   **Оператор** — создание и первичная обработка заявок
    -   **Менеджер** — управление заявками, изменение статусов
    -   **Кредитный отдел** — финальное одобрение или отказ

---

## Технологии

-   PHP 8+
-   Laravel Framework (только для инфраструктуры и Presentation слоя)
-   DDD + Clean Architecture
-   PSR-4 автозагрузка
-   Dependency Injection для сервисов и репозиториев

---

## Рекомендации по развитию

-   Использовать события и слушатели для асинхронных процессов
-   Реализовать CQRS (Command Query Responsibility Segregation) для сложных сценариев
-   Добавить слой Application DTO для упрощения передачи данных
-   Внедрить тесты на всех слоях: unit для Domain, интеграционные для Application, e2e для Presentation

---

## Контакты и помощь

Если нужна помощь с реализацией — обращайтесь!

---

_Этот README описывает пример реализации DDD-архитектуры для CRM API по работе с заявками._
